## Классификация проблем (создание *_classified.csv)

Новый этап формирует CSV с колонками проблем, который затем используется генератором отчёта.

Требуется список проблем на русском языке (мастер-список), по одной на строке:

```
data/problems_ru.txt
```

Пример запуска отдельной команды классификации:

```bash
python -m cli.classify --input tanzania_problems_3000.csv \
  --problems-file data/problems_ru.txt \
  --langs en,sw \
  --output tanzania_problems_3000_classified.csv \
  --wide
```

Пояснения:
- --langs (обязательный): 1–2 кода языков по ISO 639‑1. Примеры: en (английский), sw (суахили). Если параметр не указан — команда завершится ошибкой и подскажет пример.
- --wide (опционально): добавить «широкий» вид — булевы столбцы на каждую проблему и язык (one‑hot).
- --max-labels (опционально): верхняя граница числа меток на текст (по умолчанию 3). LLM возвращает до N кандидатов; итоговая колонка `problem_russ` содержит первую из них; кандидаты сохраняются в `problem_russ_candidates` (строка с разделителем `|`).

Выходные колонки:
- `problem_russ_candidates` — список RU-проблем (через `|`).
- `problem_russ` — первая проблема из кандидатов (её использует текущий пайплайн и таблица частот).
- Для каждого языка из `--langs`:
  - `problem_<lang>_candidates`, `problem_<lang>` — аналоги на языке `<lang>`.
- При `--wide`: булевы столбцы `ru_<label>`, `<lang>_<label>` для всех обнаруженных меток.

Важно: таблица распределения частот в отчёте считает частоты по колонке `problem_russ` (ровно одна метка на строку), поэтому формат кандидатов на неё не влияет.

### Оценка стоимости

Мы печатаем токены по этапам. Для грубой оценки стоимости используйте тарифы (на момент написания):
- gpt-4.1-mini: $0.40 / $1.60 (Input/Output) за 1М токенов
- gpt-4.1: $2.00 / $8.00 (Input/Output) за 1М токенов

Как посчитать:
- Стоимость = (prompt_tokens × цена_input + completion_tokens × цена_output) / 1_000_000.
- Для этапа перевода и классификации используется `OPENAI_MODEL_CLASSIFY` (по умолчанию gpt-4.1-mini).
- Для генерации — `OPENAI_MODEL_GENERATE` (по умолчанию gpt-4.1).
- Для редактора — `OPENAI_MODEL_EDITOR` (по умолчанию gpt-4.1).

Пример:
```
[1/4] Перевод ... | токены: {prompt_tokens: A, completion_tokens: B}
Оценка стоимости (mini): (A*0.40 + B*1.60)/1e6 USD
```

### Интеграция в основной генератор отчёта

Можно выполнить классификацию автоматически перед генерацией DOCX, если в CSV ещё нет колонки перевода:

```bash
set PROBLEMS_RU_FILE=data/problems_ru.txt
python -m cli.main --input tanzania_problems_3000.csv --country Tanzania \
  --auto-classify --langs en,sw
```

Если `--auto-classify` указан, но `--langs` пропущен — команда завершится ошибкой с подсказкой.

### Параллельная генерация и логирование

- `--concurrency N` — распараллелить генерацию/редактирование разделов (потоки). По умолчанию 1.
- В терминал печатаются этапы [1/6..6/6], количество разделов, тайминги, токены по разделам, итог по токенам.
- Требования к цитатам: оригинал + перевод в круглых скобках. В DOCX цитаты выводятся меньшим кеглем и курсивом.

# Анализ проблем жителей Того: исследование социальных сетей

## Описание проекта

Этот проект представляет собой комплексное исследование социальных проблем жителей государства Того на основе анализа высказываний в социальных сетях. Проект включает в себя автоматическую классификацию проблем с использованием ИИ и создание детализированных отчетов с социологическим анализом.

## Структура проекта

### Основные файлы

- `main.ipynb` - основной Jupyter notebook с полным циклом анализа
- `Togo_nets.csv` - исходный датасет с сообщениями из соцсетей
- `Togo_nets_classified.csv` - датасет с классифицированными проблемами
- `Togo_nets_classified_filt.csv` - отфильтрованный датасет
- `Togo_nets_problem_table.csv` - таблица с частотой проблем
- `togo_problems_report_*.docx` - сгенерированные отчеты

### Виртуальное окружение

- `venv/` - виртуальное окружение Python с установленными зависимостями

## Функциональность

### 1. Классификация проблем

Проект использует OpenAI GPT для автоматической классификации сообщений по типам проблем:

- **Экономические проблемы**: Безработица, инфляция, бедность, неравенство
- **Социальные проблемы**: Образование, здравоохранение, жилье
- **Экологические проблемы**: Изменение климата, загрязнение, наводнения
- **Политические проблемы**: Коррупция, плохое управление, нестабильность
- **Инфраструктурные проблемы**: Транспорт, электричество, интернет

### 2. Анализ данных

- Группировка сообщений по типам проблем
- Подсчет частоты встречаемости каждой проблемы
- Фильтрация и обработка данных

### 3. Генерация отчетов

Автоматическое создание детализированных отчетов в формате DOCX, включающих:
- Социологический анализ каждой проблемы
- Цитаты из оригинальных сообщений с переводом на русский
- Ссылки на источники
- Рекомендации по решению проблем

## Установка и настройка

### Требования

- Python 3.10+
- OpenAI API ключ

### Установка зависимостей

```bash
pip install pandas openai python-docx python-dotenv tqdm
```

### Настройка API ключа

1. Создайте файл `.env` в корневой папке проекта
2. Добавьте ваш OpenAI API ключ:
```
OPENAI_API_KEY=your_api_key_here
```

## Использование

### Запуск анализа

1. Откройте `main.ipynb` в Jupyter Notebook
2. Убедитесь, что файл с данными `Togo_nets.csv` находится в нужной директории
3. Выполните ячейки последовательно:
   - Загрузка данных
   - Классификация проблем с помощью ИИ
   - Анализ и группировка
   - Генерация отчета

### Основные этапы работы

1. **Загрузка данных**: Чтение CSV файла с сообщениями из соцсетей
2. **Предобработка**: Очистка и нормализация текстов
3. **Классификация**: Использование GPT для определения типа проблемы
4. **Анализ**: Группировка и подсчет статистики
5. **Отчет**: Генерация детализированного отчета с анализом

## Типы анализируемых проблем

Проект анализирует следующие категории проблем (на французском языке):

- **Corruption** - Коррупция
- **Pauvreté** - Бедность  
- **Dette publique** - Государственный долг
- **Inondations** - Наводнения
- **Inflation** - Инфляция
- **Conflits** - Конфликты
- **Violence domestique** - Домашнее насилие
- **Mauvaise gouvernance** - Плохое управление
- **Chômage** - Безработица
- И другие...

## Результаты

Проект генерирует:

1. **Количественный анализ**: Статистика по частоте упоминания проблем
2. **Качественный анализ**: Детализированное описание каждой проблемы
3. **Цитаты**: Оригинальные высказывания жителей с переводом
4. **Рекомендации**: Практические советы по решению проблем

## Технические особенности

- Использование GPT-4 для высокоточной классификации
- Обработка текстов на французском языке
- Автоматический перевод и анализ на русском языке
- Экспорт результатов в формат Microsoft Word

## Авторы и контакты

Проект разработан для анализа социальных проблем в рамках исследования африканских государств.

## Лицензия

Проект предназначен для исследовательских целей.

---

*Последнее обновление: Август 2024*
